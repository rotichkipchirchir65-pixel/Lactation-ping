<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SPARK-X Wi-Fi + Voucher + Device Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
  <style>
    body {
      background: #0f0f0f;
      color: #00ff88;
      font-family: 'Fira Code', monospace;
      padding: 20px;
      position: relative;
      z-index: 1;
    }
    input, button {
      font-family: inherit;
      padding: 8px;
      margin: 6px 4px;
      background: #111;
      color: #00ff88;
      border: 1px solid #00ff88;
      border-radius: 4px;
    }
    #log {
      white-space: pre-wrap;
      margin-top: 20px;
      background: rgba(0,255,136,0.1);
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #00ff88;
      box-shadow: 0 0 10px rgba(0,255,136,0.3);
      position: relative;
      z-index: 1;
    }
    canvas#matrix {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>

  <h1>üì° SPARK-X Wi-Fi + Voucher + Device Tracker</h1>

  <h3>üîê Voucher Activation</h3>
  <input type="text" id="voucher" placeholder="Enter voucher code (e.g. FBJVSD8)">
  <button onclick="addVoucher()">Activate Voucher</button>
  <button onclick="clearVouchers()">Clear Vouchers</button>

  <h3>‚è± Session Control</h3>
  <button onclick="startSession()">Start Session</button>
  <button onclick="extendSession(30)">Extend +30 min</button>
  <button onclick="extendSession(60)">Extend +1 hour</button>

  <div id="log">No session or voucher activity yet.</div>

  <script>
    let session = {};
    let countdownInterval;
    let vouchers = JSON.parse(localStorage.getItem("vouchers") || "[]");

    function startSession() {
      session = {
        startTime: new Date(),
        durationMinutes: 60,
        endTime: new Date(Date.now() + 60 * 60 * 1000),
        expired: false,
        device: {
          userAgent: navigator.userAgent,
          language: navigator.language,
          platform: navigator.platform,
          screen: {
            width: screen.width,
            height: screen.height,
            orientation: screen.orientation?.type || "unknown"
          },
          connection: navigator.connection?.type || "unknown"
        },
        ip: "pending",
        location: "pending"
      };

      fetch("https://api.ipify.org?format=json")
        .then(res => res.json())
        .then(data => {
          session.ip = data.ip;
          updateLog();
        });

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
            const data = await res.json();
            session.location = {
              latitude: lat,
              longitude: lon,
              area: data.address.city || data.address.town || data.address.village || "Unknown"
            };
            updateLog();
          } catch {
            session.location = { latitude: lat, longitude: lon, area: "lookup failed" };
            updateLog();
          }
        }, err => {
          session.location = "location error: " + err.message;
          updateLog();
        });
      }

      startCountdown();
      updateLog();
    }

    function extendSession(minutes) {
      if (session.expired) return;
      session.durationMinutes += minutes;
      session.endTime = new Date(session.endTime.getTime() + minutes * 60 * 1000);
      updateLog();
    }

    function startCountdown() {
      clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        const now = new Date();
        const remaining = session.endTime - now;
        if (remaining <= 0) {
          session.expired = true;
          clearInterval(countdownInterval);
        }
        updateLog();
      }, 1000);
    }

    function formatTime(ms) {
      if (ms <= 0) return "00:00:00";
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    function pad(n) {
      return n < 10 ? "0" + n : n;
    }

    function addVoucher() {
      const code = document.getElementById("voucher").value.trim().toUpperCase();
      if (!code) return;
      const now = new Date();
      const expires = new Date(now.getTime() + 24 * 60 * 60 * 1000);
      const entry = {
        code,
        activatedAt: now.toISOString(),
        expiresAt: expires.toISOString(),
        loginURL: `http://clince.net/login.html?@${code}_`
      };
      vouchers.push(entry);
      localStorage.setItem("vouchers", JSON.stringify(vouchers));
      document.getElementById("voucher").value = "";
      updateLog();
      window.open(entry.loginURL, "_blank");
    }

    function clearVouchers() {
      if (confirm("Clear all voucher logs?")) {
        vouchers = [];
        localStorage.removeItem("vouchers");
        updateLog();
      }
    }

    function updateLog() {
      const now = new Date();
      const sessionRemaining = session.endTime ? session.endTime - now : 0;
      const sessionLog = session.startTime ? {
        startTime: session.startTime.toISOString(),
        endTime: session.endTime.toISOString(),
        durationMinutes: session.durationMinutes,
        timeRemaining: formatTime(sessionRemaining),
        expired: session.expired,
        ip: session.ip,
        location: session.location,
        device: session.device
      } : "No session started.";

      const voucherLog = vouchers.map((v, i) => {
        const remaining = new Date(v.expiresAt) - now;
        const expired = remaining <= 0;
        const hrs = Math.floor(remaining / 3600000);
        const mins = Math.floor((remaining % 3600000) / 60000);
        return `#${i + 1} ‚Äî ${v.code}
Activated: ${v.activatedAt}
Expires:   ${v.expiresAt}
Status:    ${expired ? "‚ùå Expired" : `‚úÖ ${hrs}h ${mins}m left`}
Login:     ${v.loginURL}\n`;
      }).join("\n");

      document.getElementById("log").textContent =
        `üì∂ Session:\n${typeof sessionLog === "string" ? sessionLog : JSON.stringify(sessionLog, null, 2)}\n\nüîê Vouchers:\n${voucherLog || "No vouchers logged."}`;
    }

    updateLog();

    // Matrix animation
    const canvas = document.getElementById("matrix");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789„ÅÇ„ÅÑ„ÅÜ„Åà„ÅäÊº¢Â≠ó„Éá„Éº„ÇøÊú™Êù•ÂÖâÈÄü";
    const fontSize = 14;
    const columns = canvas.width / fontSize;
    const drops = Array(Math.floor(columns)).fill(1);

    function drawMatrix() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#00ff88";
      ctx.font = fontSize + "px monospace";

      for (let i = 0; i < drops.length; i++) {
        const text = chars[Math.floor(Math.random() * chars.length)];
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }

    setInterval(drawMatrix, 50);
  </script>
</body>
</html>
